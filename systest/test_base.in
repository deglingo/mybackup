# -*- shell-script -*-
# test_base - sanity checks and basic stuff


# test_base_help:
#
test_base_help()
{
	cat <<EOF
Performs some sanity checks on the install and report system details.
EOF
}


# test_base_setup:
#
test_base_setup()
{
	true
}


# _mbpy
_mbpy()
{
	"@PYTHON@" -c 'import mybackup; print(mybackup.__file__)'
}


# test_base_main:
#
test_base_main()
{
	info "hello, I am '$ST_USER:$ST_GROUP' and I live in '$ST_HOME' with '$ST_SHELL'"
	# check paths
	local mbdump="`which mbdump`" || die "mbdump not found"
	local mbclean="`which mbclean`" || die "mbclean not found"
	local mbpy="`_mbpy`" || die "mybackup module not found"
	test -x "$mbdump" \
		|| die "mbdump is not executable: '$mbdump'"
	test -x "$mbclean" \
		|| die "mbclean is not executable: '$mbclean'"
	test -f "$mbpy" || die "mybackup module not found: '$mbpy'"
	# report
	info "mbdump:   '$mbdump' (`readlink -e $mbdump`)"
	info "mbclean:  '$mbclean' (`readlink -e $mbclean`)"
	info "mbpy:     '$mbpy' (`readlink -e $mbpy`)"
	# dump environment
	info "`fill -lf'=' '== ENV ='`"
	local l
	env | sort | while read l; do info " $l"; done
	info "`fill -f'='`"
	# list files
	cd "$ST_ROOTDIR"
	info "`fill -lf'=' '== FILES ='`"
	find -print0 | sort -z | xargs -0 ls -lhd
	info "`fill -f'='`"
	info "bye!"
}
