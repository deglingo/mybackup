#!@SHELL@
# -*- shell-script -*-


# setup
#
test_base_setup()
{
	st_mkfile "/etc/mybackup/test/mybackup.conf" - <<EOF
{
  "disks": {
    "HOME": {
      "orig": "$ST_ROOTDIR/somewhere/else/home/bob",
      "path": "$ST_ROOTDIR/home/bob",
      "hooks": [["schedule", "./HOOK", "%(config)s", "%(disk)s", "%(orig)s", "%(path)s"]]
    },
    "STUFF": {
      "orig": "",
      "path": "$ST_ROOTDIR/stuff",
      "hooks": []
    }
  }
}
EOF

	st_mkfile -m755 "/etc/mybackup/test/HOOK" - <<EOF
#!/bin/sh
echo "HOOK: \$# ARGS:"
for A in \$@; do
  echo " - '\$A'"
done
echo "HOOK: ALL DONE!"
EOF

	st_mkfile "/home/bob/FILE1" - <<EOF
Lots of data...
EOF

	st_mkfile "/stuff/FILE2" - <<EOF
Some stuff...
EOF
}


# main
#
test_base_main()
{
	trace "MBDUMP: '$MBDUMP' (`which $MBDUMP`)"
	"$MBDUMP" --help >"$ST_ROOTDIR/tmp/mbdump-help.txt"
	
	# day 1
	title "DAY 1" 70
	"$MBDUMP" test
	
	# day 2
	sleep 1 # removeme
	title "DAY 2" 70
	"$MBDUMP" test
	
	# day 3
	sleep 1 # removeme
	title "DAY 3" 70
	"$MBDUMP" test
}
